\section*{Discussion}

We present a new approach to performing and communicating
experimental science.  Our use of
typed, functional and reactive programming overcomes at least three
long-standing issues in bioinformatics: the need for a flexible
ontology to share heterogeneous data from physiological experiments
\citep{Amari2002}, a language for describing experiments unambiguously
\citep{Murray-Rust2002}, and an equational formulation of data
provenance \citep{Pool2002}. 

The types we have presented form a linguistic framework and an
ontology for physiology. Thanks to the flexibility of parametric
polymorphism, our ontology can form the basis for the interchange of
physiological data and meta-data without imposing unnecessary
constraints on what can be shared. The ontology is non-hierarchical
and would be difficult to formulate in the various existing semantic
web ontology frameworks (Web Ontology Language, \citep{owlref}, or
Resource Description Framework), which lack parametric polymorphism
and functional abstraction. Nevertheless, by specifying the categories
of mathematical objects that constitute evidence, it is an ontology in
the classical sense of cataloguing the categories within a specific
domain, and providing a vocabulary for that domain. We emphasise again
that it is an ontology of \emph{evidence}, not of the biological
entities that give rise to this evidence. It is unusual as an ontology
for scientific knowledge in being embedded in a \emph{computational}
framework, such that it can describe not only mathematical objects but
also their transformations and observations. Recent work on meta-data
\citep{Bower2009} representation has focused on delineating the
information needed to repeat an experiment \citep{Taylor2007,
  Gibson2008}, but in practice it is not clear \emph{a priori} what
aspects of an experiment could influence its outcome. Here, we aim to
describe unambiguously only those aspects of the meta-data of an
experiment that are machine-executable. Any other information must be
added on an ad-hoc basis, but can still exploit the temporal contexts
provided by CoPE, i.e. exist as signal, events or durations. Thus, we
make no distinction between the representation of data and
meta-data. All relevant information about an experiment is indexed by
time and thus linked by overlap on a common time scale.

Parametric polymorphism and first-class functions are associated with
academic rather than mainstream programming languages. Where these
features are missing, they can be emulated with tricks such as
function pointers. Much of CoPE can probably be implemented in \C++,
where template metaprogramming implements a static form of parametric
polymorphism and template functors can be used to represent
functions. These must all be resolved at compile-time, so it is
difficult to use dynamically calculated or arbitrarily complex
functions. The importance of true first-class functions and parametric
polymorphism is increasingly recognized and these features have been
or are being implemented in the mainstream programming languages \C++, \Csharp\, and
Java. We therefore expect that it will soon be possible to
implement the formalism we are proposing in a wide range of
programming languages.

% HN 2010-11-24: Instead of
%
% Our mathematical definitions are less ambiguous than definitions
% written in plain English, 
% 
% to make it consistent with "unambiguous" above, I propose
%
Our mathematical definitions are unambiguous and concise, unlike
typical definitions written in natural language, and are more powerful
than those specified by graphical user interfaces or in formal
languages that lack a facility for defining abstractions. Our
framework is not only a theoretical formalism, but we also demonstrate
that it can be implemented as a very practical tool. This tool
consists of a collection of computer programs for executing
experiments and analyses, and carrying out data
management. Controlling experimentation and analysis with programs
that share data formats can be highly efficient, and eliminates many
sources of human error. Existing tools use differential equations to
define dynamic clamp experiments (Model Reference Current Injection
(MRCI); \citep{Raikov2004}) or simulations (X-Windows Phase Plane
(XPP); \citep{Ermentrout1987}). Here, we show that a general
(polymorphic) defintion of signal and events, embedded in the lambda
calculus, can define a much larger range of experiments, and the
evidence that they produce. Our experiment definitions have the
further advantage that they \emph{compose}; that is, more complex
experiments can be formulated by joining together elementary building
blocks.


Our full approach is particularly relevant to the execution of very
complex and multi-modal experiments, which may need to be dynamically
reconfigured based on previous observations, or to disambiguate
difficult judgements about evidence \citep{Kriegeskorte2009}. Even
if used separately, however, individual aspects of CoPE can make
distinct contributions to scientific methodology. For instance, our
ontology for physiological evidence can be used within more
conventional programming languages or web applications that facilitate
data sharing. In a similar way, the capabilities of CoPE for executing
and analysing experiments could provide a robust core for innovative
graphical user interfaces.

We have argued that observational data, experiments and analyses
formulated in CoPE or similar frameworks are less ambiguous and more
transparent than many contemporary research studies. The structure of
CoPE presents additional opportunities for excluding some procedural
errors in scientific inference. For instance, a simple extension to
simple type theory adds not only a consistency check for dimensional
units but also incorporates many aspects of dimensional analysis, such
as Buckingham's $\pi$-theorem \citep{Kennedy1997}. Furthermore, in our
formulation, the experimentally observed values exist as mathematical
objects within a computational framework that can be used to define
probability distributions. Hierarchical probabilistic notation
\citep{Gelman2006} permits the construction of flexible statistical
models for the directly observed data. The integration of our
formalism for experiments and heterogeneous observations with
statistical programming languages \citep{Gilks1994, AutoBayes,mlwin}
that facilitates parameter estimation using Bayesian or maximum
likelihood methods in such models could be used to obtain quantitative
estimates of measurement uncertainties taking into account all
available information.

Previous: A corollary of our work is that it may be possible in
principle to mechanically verify scientific inference, just as
mathematical proofs can be verified by a proof checker
\citep{DeBruijn1968, Harrison2009}. It is of course not possible to
verify particular hypotheses about the physical world, or an organism
in this way. What might be verifiable are statements about experiments
--- for instance, that: particular variables were randomly controlled
and not observed; outcomes have not gained correlation due to the
analysis procedure; missing data are accounted for by the statistical
model \citep{Gelman2003}; errors are propagated correctly
\citep{Taylor1997}; units of measurement are used consistently
\citep{Kennedy1997}; there is no ``double dipping''
\citep{Kriegeskorte2009}; and, ultimately, that the observed data
support the conclusions drawn. Statistical analyses address some of
these issues in relating observations to parameter estimation and
hypothesis testing. Without knowing where observations come from,
however, it is difficult to ascertain whether they provide evidence
for a given scientific hypothesis \citep{Pool2002}. Experiment
description languages, and the representation of experimental
observations into values of concrete types (which may not always be
real numbers), could play an important role in such inference. It is
likely that at least some aspects of validation in physiology can be
achieved with conservative extensions of
% the calculus of physiological evidence 
CoPE integrated with statistical inference.

\section*{Experimental Procedures}

\subsubsection*{Language implementation}

We have used two different implementation strategies for reasons of
rapid development and execution efficiency. For purposes of
experimentation and simulation, we have implemented a prototype
compiler that can execute some programs that contain signals and
events defined by mutual recursion, as is necessary for the
experiments in this paper. The program is transformed by the compiler
into a normal form that is translated to an imperative program which
iteratively updates variables corresponding to signal values, with a
time step that is set explicitly. The program is divided into a series
of stages, where each stage consists of the signals and events defined
by mutual recursion, subject to the constraints of input/output
sources and sinks. This ensures that signal expressions can reference
values of other signals at arbitrary time points (possibly in the
future) as long as referenced signals are computed in an earlier
stage.

To calculate a new value from existing observations after data
acquisition, we have implemented the calculus of physiological
evidence as a domain-specific language embedded in the purely functional
programming language Haskell.

For hard real-time dynamic-clamp experiments, we have built a compiler
back-end targeting the LXRT (user-space) interface to the RTAI (Real-time
application interface; \url{http://rtai.org}) extensions of the Linux
kernel, and the Comedi (\url{http://comedi.org}) interface to data
acquisition hardware. Geometric shapes were rendered using OpenGL
(\url{http://opengl.org}).

All code used for experiments, data analysis and generating figures is
available at \url{http://github.com/glutamate/bugpan} under the GNU General
Public License (GPL).

\subsubsection*{Locust experiments}

Locusts were maintained at 1,600 m$^{-3}$ in 50$\times$50$\times$50 cm cages under a
standard light and temperature regime of 12h light at 36°C : 12h dark
at 25°C. They were fed ad lib with fresh wheat seedlings and bran
flakes. Recordings from locust DCMD neurons were performed as
previously described \citep{Matheson2004}. Briefly, locusts were fixed
in plasticine with the ventral side upwards. The head was fixed with
wax
% at a $90^{\circ}$ angle
and the connectives were exposed through an
incision in the soft tissue of the neck. A pair of silver wire hook
electrodes were placed underneath a connective and the electrodes
and connective enclosed in petroleum jelly. The electrode signal was
amplified 1000x and bandpass filtered 50--5000 Hz, before
analog-to-digital conversion at 18 bits and 20 kHz with a National
Instruments PCI-6281 board. The locust was placed in front of a 22''
CRT monitor running with a vertical refresh rate of 160 Hz. All
aspects of the visual stimulus displayed on this monitor and of
the analog-to-digital conversion performed by the National Instruments
board were controlled by programs written in
% the calculus of physiological evidence
CoPE running on a single computer.

The full code for the locust experiment is given in Listing 1
(Supplementary Materials).

\subsubsection*{Zebrafish experiments}

Zebrafish were maintained according to established procedures
\citep{Westerfield1994} in approved tank facilities, in compliance
with the Animals (Scientific Procedures) Act 1986 and according to
University of Leicester guidelines. Intracellular patch-clamp
recordings from motor neurons in the spinal cord of a 2-day old
zebrafish embryo were performed as previously described
\citep{McDearmid2006}. We used a National Instruments PCI-6281 board
to record the output from a BioLogic patch-clamp amplifier in
current-clamp mode, filtered at 3kHz and digitised at 10 kHz, with the
output current calculated at the same rate by programs written in
% the calculus of physiological evidence
CoPE targeted to the RTAI backend (see
above). The measured jitter for updating the output voltage was 6
$\mu$s and was similar to that measured with the RTAI latency test
tool for the experiment control computer.

The full code for the Zebrafish experiments is given in Listing 2
(Supplementary Materials).

\subsubsection*{Author Contributions}  

T.N. designed and implemented CoPE, carried out the experiments and
data analyses, and wrote the draft of the paper. H.N. contributed to
the language design, helped clarify the semantics, and wrote several
sections of the manuscript. T.M. contributed to the design of the
experiments and the data analysis, and made extensive comments on
drafts of the manuscript. All authors obtained grant funding to
support this project as described in the acknowledgements.

\subsubsection*{Acknowledgements}  

We would like to thank Jonathan McDearmid for help with the Zebrafish
recordings and Angus Silver, Guy Billings, Antonia Hamilton, Nick
Hartell and Rodrigo Quian Quiroga for critical comments on the
manuscript. This work was funded by a Human Frontier Science Project
fellowship to T.N., a Biotechnology and Biological Sciences Research
Council grant to T.M. and T.N., and Engineering and Physical Sciences Research
Council grants to H.N.



